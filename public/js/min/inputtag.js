!function(t){var a=new Array,e=5,n=new Array;t.fn.doAutosize=function(a){var e=t(this).data("minwidth"),i=t(this).data("maxwidth"),n="",d=t(this),r=t("#"+t(this).data("tester_id"));if(n!==(n=d.val())){var u=n.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");r.html(u);var o=r.width(),s=o+a.comfortZone>=e?o+a.comfortZone:e,l=d.width(),p=l>s&&s>=e||s>e&&i>s;p&&d.width(s)}},t.fn.resetAutosize=function(a){var e=t(this).data("minwidth")||a.minInputWidth||t(this).width(),i=t(this).data("maxwidth")||a.maxInputWidth||t(this).closest(".tagsinput").width()-a.inputPadding,n=t(this),d=t("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:n.css("fontSize"),fontFamily:n.css("fontFamily"),fontWeight:n.css("fontWeight"),letterSpacing:n.css("letterSpacing"),whiteSpace:"nowrap"}),r=t(this).attr("id")+"_autosize_tester";!t("#"+r).length>0&&(d.attr("id",r),d.appendTo("body")),n.data("minwidth",e),n.data("maxwidth",i),n.data("tester_id",r),n.css("width",e)},t.fn.addTag=function(i,d){return d=jQuery.extend({focus:!1,callback:!0},d),this.each(function(){var e=t(this).attr("id"),r=t(this).val().split(a[e]);if(""==r[0]&&(r=new Array),i=jQuery.trim(i),d.unique){var u=t(this).tagExist(i);1==u&&t("#"+e+"_tag").addClass("not_valid")}else var u=!1;if(""!=i&&1!=u){if(t("<span>").addClass("tag primary").append(t("<span>").text(i).append("&nbsp;&nbsp;"),t("<a>",{href:"#",title:"Removing tag",text:"x"}).addClass("delete").click(function(){return t("#"+e).removeTag(escape(i))})).insertBefore("#"+e+"_addTag"),r.push(i),t("#"+e+"_tag").val(""),d.focus?t("#"+e+"_tag").focus():t("#"+e+"_tag").blur(),t.fn.tagsInput.updateTagsField(this,r),d.callback&&n[e]&&n[e].onAddTag){var o=n[e].onAddTag;o.call(this,i)}if(n[e]&&n[e].onChange){var s=r.length,o=n[e].onChange;o.call(this,t(this),r[s-1])}}}),t(".tag").length>e-1&&t("#tags_tag").hide(),!1},t.fn.removeTag=function(d){return d=unescape(d),this.each(function(){var e=t(this).attr("id"),r=t(this).val().split(a[e]);for(t("#"+e+"_tagsinput .tag").remove(),str="",i=0;i<r.length;i++)r[i]!=d&&(str=str+a[e]+r[i]);if(t.fn.tagsInput.importTags(this,str),n[e]&&n[e].onRemoveTag){var u=n[e].onRemoveTag;u.call(this,d)}}),t(".tag").length<e&&t("#tags_tag").show(),!1},t.fn.tagExist=function(e){var i=t(this).attr("id"),n=t(this).val().split(a[i]);return jQuery.inArray(e,n)>=0},t.fn.importTags=function(a){var e=t(this).attr("id");t("#"+e+"_tagsinput .tag").remove(),t.fn.tagsInput.importTags(this,a)},t.fn.tagsInput=function(e){var i=jQuery.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},e),r=0;return this.each(function(){if("undefined"==typeof t(this).attr("data-tagsinput-init")){t(this).attr("data-tagsinput-init",!0),i.hide&&t(this).hide();var e=t(this).attr("id");e&&!a[t(this).attr("id")]||(e=t(this).attr("id","tags"+(new Date).getTime()+r++).attr("id"));var u=jQuery.extend({pid:e,real_input:"#"+e,holder:"#"+e+"_tagsinput",input_wrapper:"#"+e+"_addTag",fake_input:"#"+e+"_tag"},i);a[e]=u.delimiter,(i.onAddTag||i.onRemoveTag||i.onChange)&&(n[e]=new Array,n[e].onAddTag=i.onAddTag,n[e].onRemoveTag=i.onRemoveTag,n[e].onChange=i.onChange);var o='<div id="'+e+'_tagsinput" class="tagsinput"><div id="'+e+'_addTag">';if(i.interactive&&(o=o+'<input id="'+e+'_tag" value="" data-default="'+i.defaultText+'" />'),o+='</div><div class="tags_clear"></div></div>',t(o).insertAfter(this),t(u.holder).css("width",i.width),t(u.holder).css("min-height",i.height),t(u.holder).css("height",i.height),""!=t(u.real_input).val()&&t.fn.tagsInput.importTags(t(u.real_input),t(u.real_input).val()),i.interactive){if(t(u.fake_input).val(t(u.fake_input).attr("data-default")),t(u.fake_input).css("color",i.placeholderColor),t(u.fake_input).resetAutosize(i),t(u.holder).bind("click",u,function(a){t(a.data.fake_input).focus()}),t(u.fake_input).bind("focus",u,function(a){t(a.data.fake_input).val()==t(a.data.fake_input).attr("data-default")&&t(a.data.fake_input).val(""),t(a.data.fake_input).css("color","#000000")}),void 0!=i.autocomplete_url){autocomplete_options={source:i.autocomplete_url};for(attrname in i.autocomplete)autocomplete_options[attrname]=i.autocomplete[attrname];void 0!==jQuery.Autocompleter?(t(u.fake_input).autocomplete(i.autocomplete_url,i.autocomplete),t(u.fake_input).bind("result",u,function(a,n,d){n&&t("#"+e).addTag(n[0]+"",{focus:!0,unique:i.unique})})):void 0!==jQuery.ui.autocomplete&&(t(u.fake_input).autocomplete(autocomplete_options),t(u.fake_input).bind("autocompleteselect",u,function(a,e){return t(a.data.real_input).addTag(e.item.value,{focus:!0,unique:i.unique}),!1}))}else t(u.fake_input).bind("blur",u,function(a){var e=t(this).attr("data-default");return""!=t(a.data.fake_input).val()&&t(a.data.fake_input).val()!=e?a.data.minChars<=t(a.data.fake_input).val().length&&(!a.data.maxChars||a.data.maxChars>=t(a.data.fake_input).val().length)&&t(a.data.real_input).addTag(t(a.data.fake_input).val(),{focus:!0,unique:i.unique}):(t(a.data.fake_input).val(t(a.data.fake_input).attr("data-default")),t(a.data.fake_input).css("color",i.placeholderColor)),!1});t(u.fake_input).bind("keypress",u,function(a){return d(a)?(a.preventDefault(),a.data.minChars<=t(a.data.fake_input).val().length&&(!a.data.maxChars||a.data.maxChars>=t(a.data.fake_input).val().length)&&t(a.data.real_input).addTag(t(a.data.fake_input).val(),{focus:!0,unique:i.unique}),t(a.data.fake_input).resetAutosize(i),!1):void(a.data.autosize&&t(a.data.fake_input).doAutosize(i))}),u.removeWithBackspace&&t(u.fake_input).bind("keydown",function(a){if(8==a.keyCode&&""==t(this).val()){a.preventDefault();var e=t(this).closest(".tagsinput").find(".tag:last").text(),i=t(this).attr("id").replace(/_tag$/,"");e=e.replace(/[\s]+x$/,""),t("#"+i).removeTag(escape(e)),t(this).trigger("focus")}}),t(u.fake_input).blur(),u.unique&&t(u.fake_input).keydown(function(a){(8==a.keyCode||String.fromCharCode(a.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,\/]+/))&&t(this).removeClass("not_valid")})}}}),this},t.fn.tagsInput.updateTagsField=function(e,i){var n=t(e).attr("id");t(e).val(i.join(a[n]))},t.fn.tagsInput.importTags=function(e,d){t(e).val("");var r=t(e).attr("id"),u=d.split(a[r]);for(i=0;i<u.length;i++)t(e).addTag(u[i],{focus:!1,callback:!1});if(n[r]&&n[r].onChange){var o=n[r].onChange;o.call(e,e,u[i])}};var d=function(a){var e=!1;return 13==a.which?!0:("string"==typeof a.data.delimiter?a.which==a.data.delimiter.charCodeAt(0)&&(e=!0):t.each(a.data.delimiter,function(t,i){a.which==i.charCodeAt(0)&&(e=!0)}),e)}}(jQuery);